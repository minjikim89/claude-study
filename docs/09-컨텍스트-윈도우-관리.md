# 컨텍스트 윈도우 실전 관리 — 200k 토큰의 현실

## 컨텍스트 윈도우란?

Claude가 한 번에 "볼 수 있는" 텍스트의 총량이 **컨텍스트 윈도우**다. Claude Code는 현재 약 **200k 토큰**(약 15만 단어, 한국어 기준 약 7-8만 단어)을 지원한다.

숫자만 보면 엄청 많아 보이지만, 실제로 쓰다 보면 생각보다 빨리 찬다.

## 노코드 도구와의 차이

| 노코드 도구 | Claude Code |
|---|---|
| 실행 히스토리가 별도 저장됨 | 모든 대화가 컨텍스트 윈도우 안에 쌓임 |
| 이전 실행 결과에 접근 가능 | 세션이 끝나면 대화 내용 소멸 |
| 데이터 용량 제한은 있지만 대화 길이 제한은 없음 | **대화가 길어지면 성능 저하** |

이것이 Claude Code의 모든 기억 체계(CLAUDE.md, Memory, Skill, Subagent)가 존재하는 이유다. **유한한 컨텍스트를 효율적으로 쓰기 위한 설계**.

## 200k 토큰은 실제로 어느 정도인가?

### 토큰 소비 감각

| 항목 | 대략적 토큰 수 |
|---|---|
| 한국어 1글자 | 약 1-3 토큰 |
| 영문 1단어 | 약 1 토큰 |
| 코드 1줄 | 약 10-20 토큰 |
| 일반 대화 메시지 1개 | 약 50-200 토큰 |
| 500줄 코드 파일 1개 | 약 5,000-10,000 토큰 |
| Claude의 긴 응답 1개 | 약 500-3,000 토큰 |
| CLAUDE.md (간결하게 작성) | 약 200-500 토큰 |

### 컨텍스트가 빨리 차는 경우

```
위험 시나리오:
  "이 프로젝트 전체 코드를 다 읽어줘"
  → 파일 20개 × 평균 5,000 토큰 = 100,000 토큰 (절반 소진)
  → 이후 대화할 여유가 절반밖에 안 남음

안전 시나리오:
  "src/auth/ 폴더의 로그인 관련 파일만 읽어줘"
  → 파일 3개 × 5,000 토큰 = 15,000 토큰 (7.5% 소진)
  → 여유롭게 대화 계속 가능
```

## 컨텍스트 소비 구조

세션이 시작되면 컨텍스트가 다음과 같이 채워진다:

```
200k 토큰 전체
┌──────────────────────────────────────────┐
│ ██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │
│ ↑                                        │
│ 시스템 프롬프트                            │
│ (CLAUDE.md + Auto Memory)                │
│ 약 1,000-3,000 토큰                      │
│                                          │
│ 남은 공간: ~197,000 토큰                  │
│ → 대화 + 파일 읽기 + Skill 로드에 사용     │
└──────────────────────────────────────────┘

대화 진행 후:
┌──────────────────────────────────────────┐
│ ████████████████████████████░░░░░░░░░░░░ │
│ ↑ 시스템   ↑ 대화 히스토리   ↑ 여유 공간  │
│                                          │
│ 대화가 길어질수록 여유 공간이 줄어듦        │
└──────────────────────────────────────────┘
```

## 컨텍스트가 부족해지면 일어나는 일

Claude Code는 컨텍스트 한계에 도달하면 **자동 압축**을 수행한다:

```
컨텍스트 한계 도달
  │
  ▼
이전 대화를 자동 요약/압축
  │
  ▼
요약본으로 교체 → 공간 확보
  │
  ▼
대화 계속 가능 (단, 디테일 손실 가능)
```

**문제점**: 압축 과정에서 이전 대화의 세부사항이 손실될 수 있다. "아까 3번째 파일에서 27번 줄의 변수명이 뭐였지?" 같은 질문에 정확히 답하지 못할 수 있다.

## 실전 토큰 절약 전략

### 1. 범위를 좁혀서 질문하기

```
❌ "이 프로젝트 전체 구조를 분석해줘"
   → 모든 파일을 읽으려고 시도 → 토큰 폭발

✅ "src/auth/ 폴더의 로그인 흐름을 분석해줘"
   → 관련 파일만 읽음 → 토큰 절약
```

### 2. 긴 작업은 Subagent에게 위임

```
❌ 메인 대화에서 "100개 파일 전부 검토해줘"
   → 메인 컨텍스트가 꽉 참

✅ "100개 파일을 검토해서 문제 있는 것만 알려줘"
   → Subagent가 독립 공간에서 처리 → 결과 요약만 메인에 전달
```

### 3. 새 세션으로 전환하기

```
상황: 대화가 50턴 넘어가고 Claude 응답이 느려지거나 부정확해짐

대처:
  1. 현재까지의 결론/결정사항을 정리 요청
  2. 중요한 내용은 CLAUDE.md나 파일에 기록
  3. 새 세션 시작 (Ctrl+C → claude 재실행)
  4. 깨끗한 컨텍스트에서 이어서 작업
```

### 4. CLAUDE.md를 간결하게 유지

```
❌ CLAUDE.md에 프로젝트 전체 문서를 복사
   → 매 세션마다 수천 토큰 소비

✅ CLAUDE.md에는 핵심 규칙만, 상세 내용은 Skill로 분리
   → 필요할 때만 로드하여 토큰 절약
```

### 5. `/clear` 명령어 활용

```
대화 중간에 주제가 완전히 바뀔 때:
  /clear → 대화 히스토리 초기화 (CLAUDE.md, Memory는 유지)
  → 깨끗한 상태에서 새 주제 시작
```

## 기능별 토큰 영향

| 기능 | 토큰 영향 | 관리 전략 |
|---|---|---|
| **CLAUDE.md** | 매 세션 상시 점유 | 짧게 유지 (500 토큰 이내 권장) |
| **Auto Memory** | 매 세션 상시 점유 | 200줄 이내로 자동 제한됨 |
| **Skill** | 호출 시에만 점유 | 긴 Skill도 OK (온디맨드) |
| **파일 읽기** | 읽은 만큼 점유 | 필요한 파일만 지정해서 읽기 |
| **Subagent** | 메인에 결과만 반환 | 대량 처리에 적극 활용 |
| **대화 히스토리** | 누적 점유 | 주기적으로 /clear 또는 새 세션 |

## 컨텍스트 부족 징후와 대처

| 징후 | 의미 | 대처 |
|---|---|---|
| 응답 속도가 느려짐 | 컨텍스트가 차서 처리량 증가 | 새 세션 시작 |
| 이전 대화 내용을 틀리게 기억 | 자동 압축으로 디테일 손실 | 중요 내용 파일에 기록 후 새 세션 |
| "컨텍스트 제한"류 메시지 | 한계 도달 | 즉시 새 세션으로 전환 |
| 같은 파일을 반복해서 읽으려 함 | 이전에 읽은 내용이 압축으로 손실 | Subagent 위임 고려 |

## 핵심 정리

- 컨텍스트 윈도우 200k 토큰 = Claude가 한 번에 볼 수 있는 총량
- 모든 것(시스템 프롬프트 + 대화 + 파일 읽기)이 이 공간을 공유
- 대화가 길어지면 자동 압축 → 디테일 손실 가능
- **절약 전략**: 범위 좁히기, Subagent 위임, 새 세션 전환, CLAUDE.md 간결 유지
- Claude Code의 기억 체계(CLAUDE.md, Memory, Skill, Subagent)는 모두 이 제약을 극복하기 위한 설계
