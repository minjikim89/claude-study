# Claude Code 체계 — 기억 구조와 MD 파일 레벨

## Claude Code의 동작 원리

Claude Code를 처음 접하면 "AI 챗봇"처럼 느껴지지만, 실제로는 **파일 시스템 위에서 동작하는 AI 에이전트**다. 핵심 메커니즘은 단 하나: **컨텍스트 윈도우(200k 토큰)에 텍스트를 주입하는 것**.

Claude Code의 모든 설정 — 규칙, 기억, Skill — 은 결국 마크다운 파일이고, 이 파일들이 적절한 타이밍에 컨텍스트 윈도우에 로드되는 구조다.

## 컨텍스트 윈도우 구조

```
┌─────────────────────────────────────────────────────────┐
│                    컨텍스트 윈도우 (200k 토큰)             │
│                                                          │
│  ┌──────────────┐                                        │
│  │ CLAUDE.md    │ ← 항상 자동 로드. 세션 시작과 동시에 주입  │
│  │ (전역 규칙)   │                                        │
│  └──────────────┘                                        │
│                                                          │
│  ┌──────────────┐                                        │
│  │ Auto Memory  │ ← 항상 자동 로드. MEMORY.md 내용 주입    │
│  │ (학습 기록)   │                                        │
│  └──────────────┘                                        │
│                                                          │
│  ┌──────────────┐                                        │
│  │ Skill A      │ ← "/명령어" 입력할 때만 로드             │
│  │ (레시피)      │                                        │
│  └──────────────┘                                        │
│                                                          │
│  ┌──────────────┐                                        │
│  │ 대화 내용     │ ← 사용자와 Claude의 주고받은 메시지들     │
│  └──────────────┘                                        │
└─────────────────────────────────────────────────────────┘
```

200k 토큰은 무한하지 않다. 그래서 **항상 필요한 것은 자동 로드**, **가끔 필요한 것은 온디맨드 로드**, **일시적인 것은 대화에만 존재**하도록 설계되어 있다.

## CLAUDE.md — 프로젝트의 규칙서

### 3개 레벨 시스템

CLAUDE.md는 적용 범위에 따라 3개 레벨로 존재한다.

```
~/.claude/CLAUDE.md           ← 전역: 모든 프로젝트에 적용 (개인 선호)
./CLAUDE.md                   ← 프로젝트: 이 프로젝트에 적용 (팀 공유)
./CLAUDE.local.md             ← 로컬: 이 프로젝트 + 나만 적용 (git 무시)
```

세 파일이 모두 있으면 **전부 합쳐서** 시스템 프롬프트에 주입된다.

### 각 레벨의 용도와 비유

| 레벨 | 파일 위치 | 적용 범위 | 비유 | 예시 |
|---|---|---|---|---|
| **전역** | `~/.claude/CLAUDE.md` | 내 모든 프로젝트 | 개인 업무 원칙 | "한국어로 답해", "표 형식 선호" |
| **프로젝트** | `./CLAUDE.md` | 이 프로젝트 전체 | 팀 컨벤션 문서 | "테스트 먼저 실행", "커밋 메시지 형식" |
| **로컬** | `./CLAUDE.local.md` | 이 프로젝트 + 나만 | 내 자리 포스트잇 | "디버그 모드 항상 켜기", "특정 경로 무시" |

### 노코드 도구 비교

| 노코드 도구 | Claude Code |
|---|---|
| Notion 워크스페이스 설정 | 전역 CLAUDE.md |
| 프로젝트별 설정 페이지 | 프로젝트 CLAUDE.md |
| 개인 뷰/필터 | CLAUDE.local.md |

### 작성 팁

- **짧게 유지**: 매 세션마다 로드되므로 토큰을 절약해야 함
- **명령형으로 작성**: "한국어로 응답할 것", "테스트를 먼저 실행할 것"
- **구조화**: 헤딩과 리스트로 가독성 확보
- **우선순위 명시**: 충돌 가능성이 있는 규칙은 우선순위를 적어둠

## 세션 시작 시 일어나는 일

Claude Code를 실행하면 다음 순서로 컨텍스트가 구성된다:

```
새 세션 시작
  │
  ▼
┌─ 자동 로드 (매번) ──────────────────────────────┐
│                                                  │
│  1. ~/.claude/CLAUDE.md          (전역 규칙)      │
│  2. ./CLAUDE.md                  (프로젝트 규칙)   │
│  3. ./CLAUDE.local.md            (로컬 규칙)      │
│  4. Auto Memory (MEMORY.md)      (학습 내용)      │
│                                                  │
│  → 전부 합쳐서 시스템 프롬프트에 주입              │
└──────────────────────────────────────────────────┘
  │
  ▼
┌─ 대기 (필요할 때만) ────────────────────────────┐
│                                                  │
│  5. Skills (SKILL.md들)                          │
│     → 목록만 인식, 본문은 호출 시 로드            │
│                                                  │
└──────────────────────────────────────────────────┘
  │
  ▼
  대화 시작
```

**노코드 도구 비유**: 앱을 열면 자동으로 설정이 로드되는 것과 같다. Notion을 열면 워크스페이스 설정 + 개인 설정이 자동 적용되듯이, Claude Code도 세션 시작 시 모든 MD 파일을 읽어들인다.

## 저장 위치 전체 맵

```
~/.claude/
├── CLAUDE.md                          ← 전역 규칙 (모든 프로젝트)
├── settings.json                      ← Claude Code 설정
└── projects/
    └── <프로젝트명>/
        └── memory/
            └── MEMORY.md              ← Auto Memory (프로젝트별 자동 학습)

프로젝트 루트/
├── CLAUDE.md                          ← 프로젝트 규칙 (팀 공유, git 포함)
├── CLAUDE.local.md                    ← 로컬 규칙 (나만, git 무시)
└── .claude/
    ├── skills/
    │   └── my-skill/
    │       └── SKILL.md               ← Skill (호출 시에만 로드)
    └── agents/
        └── my-agent.md                ← 커스텀 Subagent 정의
```

## 핵심 정리

- Claude Code의 모든 설정은 **마크다운 파일 → 컨텍스트 주입** 메커니즘으로 동작
- CLAUDE.md는 3개 레벨(전역/프로젝트/로컬)로 범위를 조절
- 항상 로드되는 것(CLAUDE.md, Memory)과 호출 시 로드되는 것(Skill)을 구분해서 토큰을 효율적으로 사용
- 세션이 시작되면 자동 로드 → 대기 → 대화 순서로 컨텍스트가 구성됨
